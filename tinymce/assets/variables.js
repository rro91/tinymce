tinymce.PluginManager.add("variable",function(l){var e=tinymce.util.VK;var a=l.getParam("variable_mapper",{});var r=l.getParam("variable_valid",null);var n=l.getParam("variable_class","variable");var i=l.getParam("variable_prefix","{{");var o=l.getParam("variable_suffix","}}");var u=new RegExp(i+"([a-z. _]*)?"+o,"g");function f(e){if(!r||r.length===0)return true;var a="|"+r.join("|")+"|";return a.indexOf("|"+e+"|")>-1?true:false}function v(e){if(typeof a==="function")return a(e);return a.hasOwnProperty(e)?a[e]:e}function c(e){return e.replace(/[^a-zA-Z._]/g,"")}function d(e){var a=c(e);if(!f(a))return e;var r=v(a);l.fire("variableToHTML",{value:e,cleanValue:a});var t=i+a+o;return'<span class="'+n+'" data-original-variable="'+t+'" contenteditable="false">'+r+"</span>"}function t(){var a=[],e,r,t;tinymce.walk(l.getBody(),function(e){if(e.nodeType==3&&e.nodeValue&&u.test(e.nodeValue)){a.push(e)}},"childNodes");for(var n=0;n<a.length;n++){e=a[n].nodeValue.replace(u,d);t=l.dom.create("div",null,e);while(r=t.lastChild){l.dom.insertAfter(r,a[n]);if(p(r)){var i=r.nextSibling;l.selection.setCursorLocation(i)}}l.dom.remove(a[n])}}function s(){var r=[],e,a,t;tinymce.walk(l.getBody(),function(e){if(e.nodeType==1){var a=e.getAttribute("data-original-variable");if(a!==null){r.push(e)}}},"childNodes");for(var n=0;n<r.length;n++){e=r[n].getAttribute("data-original-variable");t=l.dom.create("div",null,e);while(a=t.lastChild){l.dom.insertAfter(a,r[n])}l.dom.remove(r[n])}}function g(e){var a=l.dom.select(e)[0];if(a){var r=a.nextSibling;l.selection.setCursorLocation(r)}}function b(e){return e.format==="raw"?t():s()}function m(e){var a=d(e);l.execCommand("mceInsertContent",false,a)}function p(e){if(typeof e.getAttribute==="function"&&e.hasAttribute("data-original-variable"))return true;return false}function h(e){var a=e.target;if(!p(a))return null;var r=a.getAttribute("data-original-variable");l.fire("variableClick",{value:c(r),target:a})}l.on("nodechange",t);l.on("keyup",t);l.on("beforegetcontent",b);l.on("click",h);this.addVariable=m});
